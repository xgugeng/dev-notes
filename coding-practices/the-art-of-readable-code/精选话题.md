# 第四部分 精选话题

# 第14章 测试与可读性

- 使测试易于阅读和维护
- 对使用者隐去不重要的细节，以突出更重要的细节
- 让错误消息具有可读性
- 选择好的测试输入 – 简化输入值，一个功能多个测试
- 为测试函数命名
- 测试驱动开发

可测试性差的代码特征

| 特征 | 可测试性的问题 | 设计问题 |
| --- | --- | --- |
| 使用全局变量 | 对每个测试都要重置所有的全局变量 | 很难理解哪些函数有什么副作用，没办法独立考虑每个函数，要考虑整个程序才能理解所有的代码能否工作 |
| 对外部组件有大量依赖的代码 | 很难给它写出任何测试，因为要搭建的脚手架太多 | 对于改动很难知道它的影响 |
| 代码有不确定的行为 | 测试难以估计 | 潜在bug |

可测试性好的代码特征

| 特征 | 对可测试性的好处 | 对设计的好处 |
| --- | --- | --- |
| 类中只有很少或没有内部状态 | 容易写出测试，要测试的一个方法只要很少的设置，并有较少的隐藏状态需要检测 | 简单、容易理解 |
| 类或函数只做一件事 | 较少的测试用例 | 容易模块化，低耦合 |
| 类对别的类依赖很少，低耦合 | 每个类可以独立测试 | 系统可以并行开发 |
| 接口简单，定义明确 | 减少了测试的工作了 | 容易理解，重用 |
