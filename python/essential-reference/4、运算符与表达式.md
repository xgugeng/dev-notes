<!-- START doctoc generated TOC please keep comment here to allow auto update -->
<!-- DON'T EDIT THIS SECTION, INSTEAD RE-RUN doctoc TO UPDATE -->
**Table of Contents**  *generated with [DocToc](https://github.com/thlorenz/doctoc)*

- [4.1 数值操作](#41-%E6%95%B0%E5%80%BC%E6%93%8D%E4%BD%9C)
- [4.2 序列操作](#42-%E5%BA%8F%E5%88%97%E6%93%8D%E4%BD%9C)
- [4.3 字符串格式化](#43-%E5%AD%97%E7%AC%A6%E4%B8%B2%E6%A0%BC%E5%BC%8F%E5%8C%96)
- [4.4  高级字符串格式化](#44--%E9%AB%98%E7%BA%A7%E5%AD%97%E7%AC%A6%E4%B8%B2%E6%A0%BC%E5%BC%8F%E5%8C%96)
- [4.5 字典操作](#45-%E5%AD%97%E5%85%B8%E6%93%8D%E4%BD%9C)
- [4.6 集合操作](#46-%E9%9B%86%E5%90%88%E6%93%8D%E4%BD%9C)
- [4.7 增量操作](#47-%E5%A2%9E%E9%87%8F%E6%93%8D%E4%BD%9C)
- [4.8 属性(.)运算符](#48-%E5%B1%9E%E6%80%A7%E8%BF%90%E7%AE%97%E7%AC%A6)
- [4.9 函数调用()运算符](#49-%E5%87%BD%E6%95%B0%E8%B0%83%E7%94%A8%E8%BF%90%E7%AE%97%E7%AC%A6)
- [4.10 转换函数](#410-%E8%BD%AC%E6%8D%A2%E5%87%BD%E6%95%B0)
- [4.11 布尔表达式与真值](#411-%E5%B8%83%E5%B0%94%E8%A1%A8%E8%BE%BE%E5%BC%8F%E4%B8%8E%E7%9C%9F%E5%80%BC)
- [4.12 对象等同性与标识](#412-%E5%AF%B9%E8%B1%A1%E7%AD%89%E5%90%8C%E6%80%A7%E4%B8%8E%E6%A0%87%E8%AF%86)
- [4.13 运算符优先级](#413-%E8%BF%90%E7%AE%97%E7%AC%A6%E4%BC%98%E5%85%88%E7%BA%A7)
- [4.14 条件表达式](#414-%E6%9D%A1%E4%BB%B6%E8%A1%A8%E8%BE%BE%E5%BC%8F)
- [导航](#%E5%AF%BC%E8%88%AA)

<!-- END doctoc generated TOC please keep comment here to allow auto update -->

# 4.1 数值操作

所有数值类型都支持以下操作：

| 操作     | 描述   |
| ------ | ---- |
| x + y  | 加法   |
| x - y  | 减法   |
| x * y  | 乘法   |
| x / y  | 除法   |
| x // y | 截断除法 |
| x ** y | 乘方   |
| x % y  | 取模   |
| -x     | 一元减法 |
| +x     | 一元加法 |

截断除法`//`把结果截取为一个整数，且对整数和浮点数都有效。Python 2中，`/`也是截断除法。 Python 3中，触发的结果为浮点数。

以下移位运算符和按位逻辑运算符只能作用于整数：

| 操作     | 描述   |
| ------ | ---- |
| x << y | 左移   |
| x >> y | 右移   |
| x & y  | 按位与  |
| x \| y | 按位或  |
| x ^ y  | 按位异或 |
| ~x     | 按位求反 |

按位运算符假定整数是二进制补码表示的，且符号位可以无限向左扩展。如果使用映射到本机硬件整数的原始位模式，就要注意。因为 Python 不会截取位，或者说允许值上溢，因此结果的数量级可能会变任意大。

以下内置函数支持所有数值类型：

| 操作                    | 描述                         |
| --------------------- | -------------------------- |
| abs(x)                | 绝对值                        |
| divmod(x, y)          | 返回(x // y, x % y)。只对非复数有效。 |
| pow(x, y, [, modulo]) | 返回(x **y ) % modulo        |
| round(x, [n])         | 四舍五入为接近的10的-n 次方的倍数        |

`round`函数，Python 2会把`x`四舍五入到距离0最近的倍数。Python 3会将距离两个倍数相等的值摄入为最近的偶数倍数（如 0.5 舍入为 0.0，1.5 舍入为 2.0）。

比较运算符，返回`True`或`False`：

| 操作     | 描述   |
| ------ | ---- |
| x < y  | 小于   |
| x > y  | 大于   |
| x == y | 等于   |
| x != y | 不等于  |
| x >= y | 大于等于 |
| x <= y | 小于等于 |

`w < x < y < z`也是合法的，等价于 `w < x and x < y and y < z`。

不允许对复数进行比较，会引发 TypeError。

只有当操作符为同一类型时，比较运算符才会生效。Python 会强制转换类型：

- 如果操作数之一为复数，那另一个操作数也转换为复数。
- 如果操作数之一为浮点数，那么另一操作数也转换为浮点数。
- 否则，两个操作数肯定同为整数，无需转换。

对于用户自定义的对象，其行为取决于对象的实现。一般来说，解释器不会尝试执行任何隐式类型转换。


# 4.2 序列操作

序列类型（字符串、列表、元组）支持的运算符：

| 操作                  | 描述                         |
| ------------------- | -------------------------- |
| s + r               | 连接                         |
| s * n， n* s         | 制作 s 的 n 个副本，n 为整数         |
| v1, v2, ..., vn = s | 变量解包                       |
| s[i]                | 索引                         |
| s[i:j]              | 切片                         |
| s[i:j:stride]       | 扩展切片                       |
| x in s, x not in s  | 成员关系                       |
| for x in s:         | 迭代                         |
| all(s)              | 如果 s 中的所有项都为 True，则返回 True |
| any(s)              | 如果 s 中的任一项都为 True，则返回 True |
| len(s)              | 长度                         |
| min(s)              | s 中的最小项                    |
| max(s)              | s 中的最大项                    |
| sum(s [, initial])  | 序列所有项之和可设置一个初始值            |

字符串和元组是不可变的，但列表可以：

| 操作                | 描述       |
| ----------------- | -------- |
| s[i] = x          | 索引赋值     |
| s[i:j] = r        | 切片赋值     |
| s[i:j:stride] = r | 扩展切片赋值   |
| del s[i]          | 删除一个元素   |
| del s[i:j]        | 删除一个切片   |
| del s[i:j:stride] | 删除一个扩展切片 |


# 4.3 字符串格式化

取模运算符（`s % d`）可生成格式化的字符串，其中`s`是一个格式字符串，而`d`是一个对象元组或映射对象（字典）。

| 字符   | 输出格式                           |
| ---- | ------------------------------ |
| d，i  | 十进制整数或长整数                      |
| u    | 无符号整数或长整数                      |
| o    | 八进制整数或长整数                      |
| x    | 十六进制整数或长整数                     |
| X    | 十六进制整数（大写字母）                   |
| f    | 浮点数，如[-]m.dddddd               |
| e    | 浮点数，如[-]m.dddddde+xx           |
| E    | 浮点数，如[-]m.ddddddE+xx           |
| g, G | 指数小于-4或更高精度时使用%e 或 %E，否则使用 g%f |
| s    | 字符串或人以对象，格式化代码使用 str() 生成字符串   |
| r    | 通 repr() 生成的字符串                |
| c    | 单个字符                           |
| %    | 字面量%                           |

```python 
a = 42
b = 13.142783
c = "hello"
d = {'x': 13, 'y': 1.54321, 'z': 'world'}
e = 5628398123741234

r = "a is %d" % a # r = "a is 42"
r = "%10d %f" % (a, b) # r = "       42 13.142783"
r = "+010d %E" % (a, b) # r = "+000000042 13.14278E+01"
r = "%(x)-10d %(y)0.3g" % d # r = "13        1.54"
r = "%0.4s %s" % (c, d['z']) # r = "hell world"
r = "%*.*f" % (5, 3, b) # r = "13.143"
r = "e = %d" % e # r = "e = 5628398123741234"
```

和字典一起使用时：

```python
stock = {
    'name': 'GOOG',
    'shares': 100,
    'price': 490.10
}

r = "%(shares)d of %(name)s at %(price)0.2f" % stock
# r = "100 shares of GOOG at 490.10
```


# 4.4  高级字符串格式化

字符串格式化更高级的形式：`s.format(*args, *kwargs)`。该函数接受未知参数和关键字参数的任意集合，并使用它们的值来替换`s`中嵌入的占位符。

```python
r = "{0} {1} {2}".format('GOOG', 100, 490.10)
r = "{name} {shares} {price}".format(name='GOOG', shares=100, price=490.10)
r = "Hello {0}, your age is {age}".format("Edi", age=20)
# 要输出一个 { or }，必须使用 {{ or }} 形式
```

占位符还可以执行其他索引和属性查找：

```python
stock = {
    'name': 'GOOG',
    'shares': 100,
    'price': 490.10
}
r = "{0[name]} {0[shares]} {0[price]}".format(stock)

x = 3 + 4j
r = "{0.real} {0.imag}".format(x)
```

还可以指定格式说明符：

```python
r = "{name:8} {share:8d} {price:8.2f}".format(name='GOOG', shares=100, price=490.10)
```

说明符的一般格式是：`[fill[align]][sign][0][width][.precision][type]]`。


# 4.5 字典操作

| 操作       | 说明          |
| -------- | ----------- |
| x = d[k] | 通过键进行索引     |
| d[k] = x | 通过键进行赋值     |
| del d[k] | 通过键删除一项     |
| k in d   | 测试某个键是否存在   |
| len(d)   | 字典中的 key 个数 |

字典的键可以是都逗号分开的：

```python
d[0, 1, 2] = "foo"
# 等价于
d[(0, 1, 2)] = "foo"
```

# 4.6 集合操作

set 和 fronzenset 类型支持的操作：

| 操作     | 说明   |
| ------ | ---- |
| s \| t | 并集   |
| s & t  | 交集   |
| s - t  | 差集   |
| s ^ t  | 对称差集 |
| len(s) | 项的个数 |
| max(s) | 最大值  |
| min(s) | 最小值  |

# 4.7 增量操作

`x += y`, `x //= y`, `x **= y`等等。

增量赋值不会违法可变性，也不会原地修改变量。执行`x += y`时，将创建一个值为`x+y`的全新对象`x`。

# 4.8 属性(.)运算符

点（.）用于访问对象的属性。

# 4.9 函数调用()运算符

`f(args)`运算符会对`f`进行函数调用。函数调用之前，Python 会从左到右对所有参数表达式进行求值。

使用`functools`模块的`partial()`函数，可以对函数参数进行部分求值：

```python
def foo(x, y, x):
    return x + y + x

from functools import partial
f = partial(foo, 1, 2)
f(3) # 结果为 6
```

函数参数的部分求值叫做科里化（currying）。

# 4.10 转换函数

要在两种类型之间进行转换：

- `int(x [, base])`
- `float(x)`
- `Complex(real [, imag])`
- `str(x)`
- `repr(x)`
- `format(x [, format_spec])`
- `eval(str)`。对字符串求值并返回对象
- `tuple(s)`
- `list(s)`
- `set(s)`
- `dict(d)`
- `frozenset(s)`
- `unichr(x)`
- `hex(x)`
- `bin(x)`
- `oct(x)`

注：`str()` 和 `repr()` 生成的结果可能不同。

# 4.11 布尔表达式与真值

`and`, `or`, `not`关键字用于构建布尔表达式。

使用表达式判断 `True` 或 `False` 时，`True`、任意非零数值、非空的字符串、列表、元组或字典，都返回`True`。`False`、0、`None`、空的列表、元组字典都返回`False`。

# 4.12 对象等同性与标识

等于运算符`x == y`，对于列表，每个元素都相同才相等，字典也一样。

标识运算符`x is y`和 `x is not y`，可以检测两个对象是否引用了内存中的同一个对象。

# 4.13 运算符优先级

除了乘方（`**`），其他运算符都是从左至右计算。

# 4.14 条件表达式

`min_value = a if a <= b else b` 是快捷方式。


# 导航

[目录](README.md)

上一章：[3、类型与对象](3、类型与对象.md)

下一章：[5、程序结构与控制流](5、程序结构与控制流.md)
