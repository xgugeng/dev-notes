- [技巧27 认识 Vim 的命令行模式](#技巧27-认识-vim-的命令行模式)
- [技巧28 在一行或多个连续行上执行命令](#技巧28-在一行或多个连续行上执行命令)
- [技巧29 使用 `:t` 和 `:m` 命令复制和移动行](#技巧29-使用-t-和-m-命令复制和移动行)
- [技巧30 在指定范围上执行普通模式命令](#技巧30-在指定范围上执行普通模式命令)
- [技巧31 重复上次的 Ex 命令](#技巧31-重复上次的-ex-命令)
- [技巧32 自动补全 Ex 命令](#技巧32-自动补全-ex-命令)
- [技巧33 把当前单词插入命令行](#技巧33-把当前单词插入命令行)
- [技巧34 回溯历史命令](#技巧34-回溯历史命令)
- [技巧35 运行 shell 命令](#技巧35-运行-shell-命令)
- [技巧36 批量运行 Ex 命令](#技巧36-批量运行-ex-命令)


# 技巧27 认识 Vim 的命令行模式

按下 `:` 之后，Vim 就会进入命令行模式。可以输入一条命令，然后按`<CR>` 执行它。任意时刻，都可以按 `<ESC>` 切换回普通模式。

在命令行模式中执行的命令又称作 Ex 命令。Vim 几乎为所有的功能都提供了相应的 Ex 命令。

Ex 命令操作范围更大，并且能够在一次执行中修改多行。

# 技巧28 在一行或多个连续行上执行命令

一个范围的形式如 `:{start},{end}` 。`{start}` 和 `{end}` 都是地址，我们可以用行号作为地址，也可以用查找模式或位置标记作为地址。

构建 Ex 命令的地址范围：
- 符号 `.` 代表当前行的地址
- `%` 代表当前文件的所有行
- `1` 文件的第一行
- `$` 文件的最后一行
- `0` 虚拟行，文件第一行的上方
- `'m` 包含位置标记 `m` 的行
- `'<` 高亮选区的起始行
- `'>` 高亮选区的结束行

定义一个 `[range]` 时，总是代表一系列连续行，`:global` 命令也可以在一系列非连续行上执行 Ex 命令。

# 技巧29 使用 `:t` 和 `:m` 命令复制和移动行

`:copy` 命令（简写形式 `:t` ）可以把一行或多行从文档的一部分复制到另一部分。`:move` 则是移动。

`:[range]t{address}` ，例如 `:6t.` 将第6行的文本复制到当前行的下方。

`:t.` 与普通模式的 `yyp` 区别在于，`yyp`会使用寄存器。

`:[range]m{address}` 用法与 `:t` 类似。

# 技巧30 在指定范围上执行普通模式命令

如果想在连续行上执行一条普通模式命令，可以用 `:normal` 命令。此命令与 `.` 命令结合使用，能完成大量重复性工作。

# 技巧31 重复上次的 Ex 命令

`@:` 可以重复上次执行的 Ex 命令。

以下两条命令在遍历缓冲区列表时非常有用：
- `:bn` 可以在列表中正向移动
- `:bp` 在列表中反向移动

我们可以输入一次 `:bn` 命令，然后再用 `@:` 重复执行它。

# 技巧32 自动补全 Ex 命令

在命令行上也可以用 `<Tab>` 来自动补全命令。

调整 `wildmode` 选项可以自定义补全行为。

# 技巧33 把当前单词插入命令行

在 Vim 的命令行模式下，`<C-r><C-w>` 映射项会复制光标下的单词并把它插入命令行中。

`*` 可以高亮当前光标位置的单词。   

# 技巧34 回溯历史命令

Vim 提供了两种方式回溯命令行模式的命令：

1. 光标回滚之前的命令：先按 `:` 进入命令行模式，然后按 `<Up>` 来查看
2. 调出命令行窗口查看：`q:` 调出命令行窗口

# 技巧35 运行 shell 命令

在 Vim 的命令行模式中，给命令加一个 `!` 就可以调用外部程序，比如 `:!ls` 。

`:shell` 命令可以启动一个交互的 shell 会话。

使用 `:!{cmd}` 时，Vim 会回显 `{cmd}` 命令的输出。`:read!{cmd}` 会把命令的输出读入当前的缓冲区。`:write!{cmd}` 做的事情正好相反。

`:[range]write!{cmd}` 在 shell 中执行 `{cmd}` ，以 `[range]` 作为起标准输入

# 技巧36 批量运行 Ex 命令

如果要执行一连串的 Ex 命令，可以把他们放入脚本，然后加载脚本即可。

执行脚本：`:source xx.vim`
